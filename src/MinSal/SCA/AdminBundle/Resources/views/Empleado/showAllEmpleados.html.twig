{# Muestra todos los empleados #}

{% block body %}
    <script type="text/javascript">
      $(document).ready(function(){
        var myGrid = $('#theGrid');        
        myGrid.jqGrid({ 
          url: 'consultarEmpleadosJSON',
          datatype:'json',
          altRows:true,
          colNames:['Id','Usuario','Primer Nombre', 'Segundo Nombre', 'Apellidos', 'DUI','NIT','Ministerio','Cargo','Email','Telefono','Password'],
          colModel:[
            { name:'idUsuario', index: 'id', width:20,editable:false,editoptions:{size:15}},
            { name:'username', index: 'username', width:90,editable:true,editoptions:{size:25,maxlength: 35,dataInit:function(el){$(el).keyfilter(/[a-z ]/i);}}, formoptions:{ rowpos:1, label: "usuario",elmprefix:"(*)"},editrules:{required:true}  },
            { name:'userPrimerNombre', index: 'nombrePrimero', width:90,editable:true,editoptions:{size:25,maxlength: 35,dataInit:function(el){$(el).keyfilter(/[a-z ]/i);}}, formoptions:{ rowpos:2, label: "Primer Nombre",elmprefix:"(*)"},editrules:{required:true}  },
            { name:'userSegundoNombre', index: 'nombreSegundo',width:90,editable:true,editoptions:{size:25,maxlength: 35,dataInit:function(el){$(el).keyfilter(/[a-z ]/i);}}, formoptions:{ rowpos:3, label: "Segundo Nombre"} },
            { name:'userApellidos', index: 'Apellidos', width:90,editable:true,editoptions:{size:25,maxlength: 35,dataInit:function(el){$(el).keyfilter(/[a-z ]/i);}}, formoptions:{ rowpos:4, label: "Apellidos",elmprefix:"(*)"},editrules:{required:true} },
            { name:'userDui', index: 'dui',width:60,editable:true,editoptions:{size:25,maxlength: 10,dataInit:function(el){$(el).mask("99999999-9",{placeholder:" "});}}, formoptions:{ rowpos:5, label: "DUI",elmprefix:"(*)"},editrules:{required:true}  },
            { name:'userNit', index: 'nit',width:60,editable:true,editoptions:{size:25,maxlength: 10,dataInit:function(el){$(el).mask("9999-999999-999-9",{placeholder:" "});}}, formoptions:{ rowpos:6, label: "NIT",elmprefix:"(*)"},editrules:{required:true}  },
            { name:'userInternoTipo', index: 'userInternoTipo',width:200,editable:true,edittype:"select",editoptions:{value:"MINSAL:Ministerio de Salud;DGII:Dirección General de Impuestos Internos;DGA:Dirección General de Aduanas;MH:Ministerio de Hacienda;DNM:Dirección Nacional de Medicamentos"} },
            { name:'userCargo', index: 'cargo',width:90,editable:true,editoptions:{size:25,maxlength: 35,dataInit:function(el){$(el).keyfilter(/[a-z ]/i);}}, formoptions:{ rowpos:8, label: "Cargo",elmprefix:"(*)"},editrules:{required:true} },
            { name:'Email', index: 'email',width:150,editable:true,hidden: true,editoptions:{size:25,maxlength: 250,dataInit:function(el){$(el).keyfilter(/[a-z0-9_\.\-@]/i);}}, formoptions:{ rowpos:9, label: "Email"},editrules:{email:true,required:false,edithidden:true} },
            { name:'userTelefono', index: 'telefono',width:90,editable:true,editoptions:{size:25,maxlength: 10,dataInit:function(el){$(el).mask("9999-9999",{placeholder:" "});}}, formoptions:{ rowpos:10, label: "Telefono",elmprefix:"(*)"},editrules:{required:true}  },
            { name:'Password', index: 'password',width:150,editable:true,edittype:"password",hidden: true,editoptions:{size:50,maxlength: 250,dataInit:function(el){$(el).keyfilter(/[a-z0-9]/i);}}, formoptions:{ rowpos:11, label: "Password"},editrules:{required:true,edithidden:true} },
          ],            
          rowNum:10,
          rowList:[10,20,30],
          multiselect: false,
          loadonce:true,
          pager: jQuery('#pager'),
          viewrecords: true, 
          caption: 'Empleados',
          height: "100%",
          editurl: 'manttEmpleadoEdicion',
          editCaption: "Editar Empleado",
          addCaption: "Agregar Empleado"
        });
        
        myGrid.jqGrid('navGrid','#pager',{edit:false,add:false,del:false,
        beforeRefresh: function() {$("#theGrid").jqGrid('setGridParam',{datatype:'json',loadonce:true}).trigger('reloadGrid');}}
        );
       
       function despuesAgregarEditar() {
        $("#theGrid").jqGrid('setGridParam',{datatype:'json',loadonce:true}).trigger('reloadGrid');
            return[true,'']; //no error
        }
        $("#agregarEmpleado").click(function(){
        jQuery('#theGrid').jqGrid('editGridRow',"new",
             {
              addCaption: "Agregar Empleado",width:550,height:370,bottominfo:"Campos marcados con (*) son obligatorios",
              afterSubmit:despuesAgregarEditar,closeAfterAdd:true,closeOnEscape: true,align:'center',
              onclickSubmit: function(rp_ge, postdata){
                                  alert("datos guardados con exito!");                                  
                                 }
              });
        });
        
    
         //editar
        $("#editarEmpleado").click(function(){
          var gr = jQuery('#theGrid').jqGrid('getGridParam','selrow');
          if( gr != null )
             jQuery('#theGrid').jqGrid('editGridRow',gr,
               { width:550,height:370,closeAfterAdd : true,editCaption: "Editar Empleado",bottominfo:"Campos marcados con (*) son obligatorios",closeAfterEdit:true,
                 afterSubmit:despuesAgregarEditar,reloadAfterSubmit:true,closeOnEscape: true,align:'center',
                 onclickSubmit: function(rp_ge, postdata) {
                              alert("datos editados con exito!");
                   }   
                       });
          else alert("Por favor seleccione una fila para editar!"); 
          });
     
        //eliminar
        $("#eliminarEmpleado").click(function(){
         var grs = jQuery('#theGrid').jqGrid('getGridParam','selrow');
         if( grs != null ) 
             jQuery('#theGrid').jqGrid('delGridRow',grs,
                 {
                msg: "Desea Eliminar Este Empleado?",caption:"Eliminando Empleado",
                width:550,height:160,reloadAfterSubmit:true,align:'center',
                onclickSubmit: function(rp_ge, postdata) {
                           alert("Empleado eliminado con exito!");
                        }
               
             }); 
             else alert("Por favor seleccione una fila para borrar!"); 
           }); 
  //fin
       
      });
    </script>
        
        <table id="theGrid" class="scroll"></table> 
        <div id="pager" class="scroll" style="text-align:center;"></div> 
        

{% endblock %}